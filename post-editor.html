<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post Editor</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #1e1e1e;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin-bottom: 10px;
            font-size: 2em;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .editor-panel, .preview-panel {
            padding: 30px;
        }

        .editor-panel {
            border-right: 2px solid #333;
            background: #252526;
        }

        .preview-panel {
            background: #1e1e1e;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e0e0e0;
            font-size: 14px;
        }

        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #404040;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
            background: #2d2d30;
            color: #e0e0e0;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            background: #333337;
        }

        textarea {
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            min-height: 300px;
        }

        .button {
            background: linear-gradient(135deg, #5865f2 0%, #7289da 100%);
            color: #ffffff;
            border: 1px solid #4752c4;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(88, 101, 242, 0.6);
            background: linear-gradient(135deg, #6b75ff 0%, #8199e8 100%);
        }

        .button:active {
            transform: translateY(0);
        }

        .button.secondary {
            background: linear-gradient(135deg, #43b581 0%, #3ba55d 100%);
            border: 1px solid #2d8a4f;
        }

        .button.secondary:hover {
            background: linear-gradient(135deg, #4fc98d 0%, #45bf6e 100%);
            box-shadow: 0 5px 20px rgba(67, 181, 129, 0.6);
        }

        .image-upload-section {
            background: #2d2d30;
            border: 2px dashed #555;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            color: #e0e0e0;
        }

        .image-upload-section:hover {
            border-color: #667eea;
            background: #333337;
        }

        .image-upload-section input[type="file"] {
            display: none;
        }

        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .image-item {
            position: relative;
            border: 2px solid #404040;
            border-radius: 6px;
            overflow: hidden;
            background: #2d2d30;
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .image-item .image-info {
            padding: 8px;
            font-size: 11px;
            color: #b0b0b0;
            word-break: break-all;
        }

        .image-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .preview-panel h2 {
            margin-bottom: 20px;
            color: #e0e0e0;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .preview-content {
            background: #252526;
            padding: 20px;
            border-radius: 6px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            color: #d4d4d4;
        }

        .preview-content img {
            max-width: 100%;
            height: auto;
        }

        .preview-content h1,
        .preview-content h2,
        .preview-content h3,
        .preview-content h4,
        .preview-content h5,
        .preview-content h6 {
            color: #e0e0e0;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        .preview-content h1 {
            font-size: 2em;
            border-bottom: 1px solid #404040;
            padding-bottom: 0.3em;
        }

        .preview-content h2 {
            font-size: 1.5em;
            border-bottom: 1px solid #333;
            padding-bottom: 0.3em;
        }

        .preview-content h3 {
            font-size: 1.25em;
        }

        .preview-content p {
            margin-bottom: 16px;
            line-height: 1.7;
            color: #d4d4d4;
        }

        .preview-content ul,
        .preview-content ol {
            margin-bottom: 16px;
            padding-left: 2em;
            line-height: 1.7;
        }

        .preview-content li {
            margin-bottom: 8px;
            color: #d4d4d4;
        }

        .preview-content blockquote {
            border-left: 4px solid #667eea;
            padding-left: 16px;
            margin: 16px 0;
            color: #b0b0b0;
            font-style: italic;
        }

        .preview-content hr {
            border: none;
            border-top: 2px solid #404040;
            margin: 24px 0;
        }

        .preview-content a {
            color: #58a6ff;
            text-decoration: none;
        }

        .preview-content a:hover {
            text-decoration: underline;
        }

        .preview-content table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }

        .preview-content table th,
        .preview-content table td {
            border: 1px solid #404040;
            padding: 8px 12px;
            text-align: left;
        }

        .preview-content table th {
            background: #2d2d30;
            font-weight: 600;
        }

        .preview-content table tr:nth-child(even) {
            background: #2a2a2a;
        }

        .preview-content code {
            background: #1e1e1e;
            color: #ce9178;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        .preview-content pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 16px;
            border: 1px solid #404040;
        }

        .preview-content pre code {
            background: transparent;
            padding: 0;
            color: #d4d4d4;
        }

        .preview-content strong {
            color: #e0e0e0;
            font-weight: 600;
        }

        .preview-content em {
            color: #d4d4d4;
            font-style: italic;
        }

        .preview-content br {
            line-height: 1.7;
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #43b581;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            font-weight: 600;
            border: 1px solid #3ba55d;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .actions {
            padding: 20px 30px;
            background: #252526;
            border-top: 2px solid #333;
            text-align: center;
        }

        .instructions {
            background: #3d3d1f;
            border: 1px solid #9d8a3f;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #f0e68c;
        }

        .instructions strong {
            display: block;
            margin-bottom: 5px;
        }

        .tag-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .tag-input-container input {
            flex: 1;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }

            .editor-panel {
                border-right: none;
                border-bottom: 2px solid #333;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Blog Post Editor</h1>
            <p>Create and preview your Jekyll blog posts with ease</p>
        </div>

        <div class="content">
            <div class="editor-panel">
                <div class="instructions">
                    <strong>üìå Instructions:</strong>
                    1. Fill in the post details below<br>
                    2. Write your content in markdown<br>
                    3. Upload images (they'll be copied to images folder)<br>
                    4. Click "Generate Post" to download the markdown file<br>
                    5. Save images to the appropriate folder and commit to GitHub
                </div>

                <div class="form-group">
                    <label for="title">Post Title *</label>
                    <input type="text" id="title" placeholder="My Awesome Blog Post" required>
                </div>

                <div class="form-group">
                    <label for="date">Date *</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="subtitle">Subtitle (optional)</label>
                    <input type="text" id="subtitle" placeholder="A brief description">
                </div>

                <div class="form-group">
                    <label for="excerpt">Excerpt (optional)</label>
                    <textarea id="excerpt" placeholder="Sentence that serves as preview for the post" style="min-height: 80px;"></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="comments" checked style="width: auto; margin-right: 8px;">
                        Enable Comments
                    </label>
                </div>

                <div class="form-group">
                    <label for="tags">Tags (comma-separated)</label>
                    <div class="tag-input-container">
                        <input type="text" id="tags" placeholder="powershell, windows, automation">
                    </div>
                </div>

                <div class="form-group">
                    <label for="categories">Categories (comma-separated)</label>
                    <input type="text" id="categories" placeholder="tutorial, tips">
                </div>

                <div class="form-group">
                    <label for="content">Post Content (Markdown) *</label>
                    <textarea id="content" placeholder="Write your post content here in markdown..."></textarea>
                </div>

                <div class="form-group">
                    <label>Images</label>
                    <div class="image-upload-section" onclick="document.getElementById('imageInput').click()">
                        <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                        <p><strong>Click to upload images</strong></p>
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">Supports: JPG, PNG, GIF, WEBP</p>
                        <input type="file" id="imageInput" accept="image/*" multiple>
                    </div>
                    <div class="uploaded-images" id="uploadedImages"></div>
                </div>
            </div>

            <div class="preview-panel">
                <h2>üìÑ Preview</h2>
                <div class="preview-content" id="preview">
                    <p style="color: #999; text-align: center; padding: 40px;">
                        Start typing to see a preview of your post...
                    </p>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="button" onclick="downloadPackage()">üì¶ Download Package (ZIP)</button>
            <button class="button" onclick="generatePost()">üíæ Generate Post Only</button>
            <button class="button secondary" onclick="clearForm()">üóëÔ∏è Clear Form</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        let uploadedImages = [];

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Auto-preview on content change
        document.getElementById('content').addEventListener('input', updatePreview);
        document.getElementById('title').addEventListener('input', updatePreview);

        // Handle image uploads
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const files = e.target.files;
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const imageData = {
                            name: file.name,
                            data: event.target.result,
                            file: file
                        };
                        uploadedImages.push(imageData);
                        displayUploadedImages();
                    };
                    reader.readAsDataURL(file);
                }
            }
            e.target.value = ''; // Clear input
        });

        function displayUploadedImages() {
            const container = document.getElementById('uploadedImages');
            container.innerHTML = '';
            
            uploadedImages.forEach((img, index) => {
                const div = document.createElement('div');
                div.className = 'image-item';
                div.innerHTML = `
                    <button class="remove-btn" onclick="removeImage(${index})" title="Remove">√ó</button>
                    <img src="${img.data}" alt="${img.name}">
                    <div class="image-info">
                        ${img.name}<br>
                        <button class="button" style="margin: 5px 0; padding: 5px 10px; font-size: 10px; background: #404040; border: 1px solid #555;" onclick="copyImageMarkdown('${img.name}')">Copy MD</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayUploadedImages();
        }

        function copyImageMarkdown(filename) {
            // Generate markdown for image based on file structure
            const date = document.getElementById('date').value;
            const year = date.split('-')[0];
            const title = document.getElementById('title').value || 'untitled';
            const slug = slugify(title);
            
            const markdown = `![${filename}](/images/${slug}/${filename})`;
            
            navigator.clipboard.writeText(markdown).then(() => {
                showCopyNotification('Copied!');
            });
        }

        function showCopyNotification(message) {
            // Remove any existing notifications
            const existing = document.querySelector('.copy-notification');
            if (existing) {
                existing.remove();
            }

            // Create notification
            const notification = document.createElement('div');
            notification.className = 'copy-notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            // Remove after 5 seconds with fade out animation
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        function updatePreview() {
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const preview = document.getElementById('preview');
            
            let html = '';
            if (title) {
                html += `<h1>${escapeHtml(title)}</h1>`;
            }
            if (content) {
                html += marked.parse(content);
            }
            
            if (!html) {
                preview.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">Start typing to see a preview of your post...</p>';
            } else {
                preview.innerHTML = html;
            }
        }

        function slugify(text) {
            return text
                .toLowerCase()
                .trim()
                .replace(/[^\w\s-]/g, '')
                .replace(/[\s_-]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function generatePost() {
            const title = document.getElementById('title').value;
            const date = document.getElementById('date').value;
            const subtitle = document.getElementById('subtitle').value;
            const excerpt = document.getElementById('excerpt').value;
            const comments = document.getElementById('comments').checked;
            const tags = document.getElementById('tags').value;
            const categories = document.getElementById('categories').value;
            const content = document.getElementById('content').value;

            if (!title || !date || !content) {
                alert('Please fill in all required fields (Title, Date, and Content)');
                return;
            }

            // Generate frontmatter
            let frontmatter = '---\n';
            frontmatter += `layout: post\n`;
            frontmatter += `title: "${title.replace(/"/g, '\\"')}"\n`;
            frontmatter += `date: ${date}\n`;
            
            if (subtitle) {
                frontmatter += `subtitle: "${subtitle.replace(/"/g, '\\"')}"\n`;
            }
            
            if (excerpt) {
                frontmatter += `excerpt: >-\n`;
                // Indent excerpt content
                const excerptLines = excerpt.split('\n');
                excerptLines.forEach(line => {
                    frontmatter += `  ${line}\n`;
                });
            }
            
            if (tags) {
                const tagList = tags.split(',').map(t => t.trim()).filter(t => t);
                if (tagList.length > 0) {
                    frontmatter += `tags: [${tagList.join(', ')}]\n`;
                }
            }
            
            if (categories) {
                const catList = categories.split(',').map(c => c.trim()).filter(c => c);
                if (catList.length > 0) {
                    frontmatter += `categories: [${catList.join(', ')}]\n`;
                }
            }
            
            frontmatter += `comments: ${comments}\n`;
            frontmatter += '---\n\n';

            // Combine frontmatter and content
            const fullContent = frontmatter + content;

            // Generate filename
            const slug = slugify(title);
            const filename = `${date}-${slug}.md`;

            // Download the file
            downloadFile(filename, fullContent);

            // Show notification
            showCopyNotification('Post file downloaded!');
        }

        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function downloadPackage() {
            const title = document.getElementById('title').value;
            const date = document.getElementById('date').value;
            const subtitle = document.getElementById('subtitle').value;
            const excerpt = document.getElementById('excerpt').value;
            const comments = document.getElementById('comments').checked;
            const tags = document.getElementById('tags').value;
            const categories = document.getElementById('categories').value;
            const content = document.getElementById('content').value;

            if (!title || !date || !content) {
                showCopyNotification('‚ö†Ô∏è Please fill in required fields!');
                return;
            }

            if (typeof JSZip === 'undefined') {
                showCopyNotification('‚ö†Ô∏è ZIP library not loaded!');
                return;
            }

            showCopyNotification('Creating package...');

            const zip = new JSZip();
            const slug = slugify(title);
            const year = date.split('-')[0];
            const filename = `${date}-${slug}.md`;

            // Generate frontmatter
            let frontmatter = '---\n';
            frontmatter += `layout: post\n`;
            frontmatter += `title: "${title.replace(/"/g, '\\"')}"\n`;
            frontmatter += `date: ${date}\n`;
            
            if (subtitle) {
                frontmatter += `subtitle: "${subtitle.replace(/"/g, '\\"')}"\n`;
            }
            
            if (excerpt) {
                frontmatter += `excerpt: >-\n`;
                // Indent excerpt content
                const excerptLines = excerpt.split('\n');
                excerptLines.forEach(line => {
                    frontmatter += `  ${line}\n`;
                });
            }
            
            if (tags) {
                const tagList = tags.split(',').map(t => t.trim()).filter(t => t);
                if (tagList.length > 0) {
                    frontmatter += `tags: [${tagList.join(', ')}]\n`;
                }
            }
            
            if (categories) {
                const catList = categories.split(',').map(c => c.trim()).filter(c => c);
                if (catList.length > 0) {
                    frontmatter += `categories: [${catList.join(', ')}]\n`;
                }
            }
            
            frontmatter += `comments: ${comments}\n`;
            frontmatter += '---\n\n';

            const fullContent = frontmatter + content;

            // Add markdown file to ZIP with proper folder structure
            zip.file(`_posts/${year}/${filename}`, fullContent);

            // Add images to ZIP with proper folder structure
            if (uploadedImages.length > 0) {
                for (const img of uploadedImages) {
                    // Convert data URL to blob
                    const base64Data = img.data.split(',')[1];
                    zip.file(`images/${slug}/${img.name}`, base64Data, { base64: true });
                }
            }

            // Don't create README to avoid Windows security warnings
            // The folder structure is self-explanatory

            // Generate and download ZIP
            try {
                const blob = await zip.generateAsync({ type: 'blob' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${slug}-package.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showCopyNotification('‚úÖ Package downloaded!');
            } catch (error) {
                showCopyNotification('‚ùå Error creating package!');
                console.error('ZIP creation error:', error);
            }
        }

        async function generateImagesZip() {
            // Redirect to download package since it's better
            downloadPackage();
        }

        function clearForm() {
            if (confirm('Are you sure you want to clear the form? This cannot be undone.')) {
                document.getElementById('title').value = '';
                document.getElementById('subtitle').value = '';
                document.getElementById('excerpt').value = '';
                document.getElementById('comments').checked = true;
                document.getElementById('tags').value = '';
                document.getElementById('categories').value = '';
                document.getElementById('content').value = '';
                document.getElementById('date').valueAsDate = new Date();
                uploadedImages = [];
                displayUploadedImages();
                updatePreview();
            }
        }

        // Initialize marked options for better rendering
        if (typeof marked !== 'undefined') {
            marked.setOptions({
                breaks: true,        // Convert \n to <br>
                gfm: true,          // GitHub Flavored Markdown
                headerIds: true,
                mangle: false,
                pedantic: false,
                sanitize: false,
                smartLists: true,
                smartypants: true   // Convert quotes and dashes
            });
        }
    </script>
</body>
</html>
