<!-- Left Sidebar Navigation -->
<div id="left-sidebar" class="left-sidebar">
  <div class="sidebar-header">
    <h4><i class="fa fa-archive"></i> Archive</h4>
    <button class="sidebar-close" onclick="closeSidebar()">&times;</button>
  </div>
  
  <div class="sidebar-content">
    <!-- Quick Search Section -->
    <div class="sidebar-section">
      <h5><i class="fa fa-search"></i> Quick Search</h5>
      <div class="sidebar-search">
        <input type="text" id="sidebar-search-input" placeholder="Search posts..." autocomplete="off" />
        <div id="sidebar-search-results" class="sidebar-search-results"></div>
      </div>
    </div>
    
    <!-- Archive by Month -->
    {% assign posts_by_month = site.posts | group_by_exp: "post", "post.date | date: '%Y-%m'" %}
    {% if posts_by_month.size > 0 %}
    <div class="sidebar-section">
      <ul class="sidebar-list archive-list">
        {% for month in posts_by_month %}
          {% assign month_name = month.name | date: "%B %Y" %}
          <li>
            <a href="#" class="archive-link" data-month="{{ month.name }}">
              {{ month_name }}
              <span class="post-count">({{ month.items.size }})</span>
            </a>
            <div class="month-posts" id="month-{{ month.name }}" style="display: none;">
              {% for post in month.items %}
                <a href="{{ post.url | relative_url }}" class="month-post-link" title="{{ post.title }}">
                  <span class="post-date">{{ post.date | date: "%d" }}</span>
                  {{ post.title }}
                </a>
              {% endfor %}
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
</div>

<!-- Sidebar Toggle Button -->
<button id="sidebar-toggle" class="sidebar-toggle" onclick="toggleSidebar()" title="Open archive menu">
  <i class="fa fa-archive"></i>
</button>

<!-- Sidebar Overlay -->
<div id="sidebar-overlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

<script>
function toggleSidebar() {
  const sidebar = document.getElementById('left-sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  const toggle = document.getElementById('sidebar-toggle');
  
  if (sidebar.classList.contains('open')) {
    closeSidebar();
  } else {
    sidebar.classList.add('open');
    overlay.classList.add('active');
    toggle.style.left = '260px';
  }
}

function closeSidebar() {
  const sidebar = document.getElementById('left-sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  const toggle = document.getElementById('sidebar-toggle');
  
  sidebar.classList.remove('open');
  overlay.classList.remove('active');
  toggle.style.left = '20px';
}

function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
  closeSidebar();
}

// Archive functionality
document.addEventListener('DOMContentLoaded', function() {
  const archiveLinks = document.querySelectorAll('.archive-link');
  archiveLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const month = this.dataset.month;
      const monthPosts = document.getElementById('month-' + month);
      
      // Toggle visibility
      if (monthPosts.style.display === 'none') {
        monthPosts.style.display = 'block';
        this.classList.add('expanded');
      } else {
        monthPosts.style.display = 'none';
        this.classList.remove('expanded');
      }
    });
  });
  
  // Sidebar search functionality
  const searchInput = document.getElementById('sidebar-search-input');
  const searchResults = document.getElementById('sidebar-search-results');
  
  // Create search data from current page posts
  const searchData = [
    {% for post in site.posts %}
    {
      title: {{ post.title | jsonify }},
      url: {{ post.url | relative_url | jsonify }},
      date: {{ post.date | date: "%B %d, %Y" | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
  
  if (searchInput && searchResults) {
    searchInput.addEventListener('input', function() {
      const query = this.value.trim().toLowerCase();
      
      if (query.length >= 3) {
        const filteredPosts = searchData.filter(post => 
          post.title.toLowerCase().includes(query)
        );
        
        displaySearchResults(filteredPosts, query);
        searchResults.style.display = 'block';
      } else {
        searchResults.style.display = 'none';
      }
    });
    
    // Hide results when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.sidebar-search')) {
        searchResults.style.display = 'none';
      }
    });
  }
  
  function displaySearchResults(posts, query) {
    if (posts.length === 0) {
      searchResults.innerHTML = '<div class="sidebar-search-no-results">No posts found</div>';
      return;
    }
    
    const resultsHTML = posts.slice(0, 8).map(post => `
      <div class="sidebar-search-result">
        <div class="sidebar-search-date">${post.date}</div>
        <a href="${post.url}">${highlightMatch(post.title, query)}</a>
      </div>
    `).join('');
    
    searchResults.innerHTML = resultsHTML;
  }
  
  function highlightMatch(text, query) {
    const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi');
    return text.replace(regex, '<strong>$1</strong>');
  }
  
  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
});

// Close sidebar when pressing Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeSidebar();
  }
});
</script>